<!DOCTYPE HTML>
<html>
    <head>
        <link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/ui-lightness/jquery-ui.css" media=screen>
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.18/jquery-ui.min.js"></script>
        <script type="text/javascript" src="js/jquery.ui.treemap.js"></script>
        <script type="text/javascript" src="blah.js"></script>
        <style type="text/css">
            canvas { border: 1px solid #f00; }
            #treemap { display: inline-block; }
            .highlighter { border: 1px solid #ff0; position: absolute; display: none; pointer-events: none; }
            .mouseoverbox { 
                border: 1px solid #aaa; 
                position: absolute; 
                background-color: #fff; 
                pointer-events: none; 
            }
            .mouseoverbox p {
                margin: 0px;
                padding: 0px;
                font-size: 0.625em;
                color: #444;
            }
        </style>
    </head>
    <body>
        <input id="t1" type="button" value="on"/>
        <input id="t2" type="button" value="800x200"/>
        <input id="t3" type="button" value="600x400"/>
        <input id="t4" type="button" value="color1"/>
        <input id="t5" type="button" value="color2"/>
        <input id="t6" type="button" value="gradient1"/>
        <input id="t7" type="button" value="gradient2"/>
        <input id="t8" type="button" value="destroy"/>
        <div><span id="treemap"></span></div>
        <div id="debug-info"><span><p>click the 'on' button to create test treemap</p></span></div>
        <div><p><a href="https://github.com/evancarey/jsTreemap">https://github.com/evancarey/jsTreemap</a></p></div>
        <div id="highlighter"></div>
        <div id="mouseoverbox" class="mouseoverbox"></div>
	    <script type="text/javascript">
            var highlighterFadeTimeout;
            var triggerHighlighterFade = function() {
                $("#highlighter").fadeOut(400,"linear");
            };
            var clearHighlighterFade = function() {
                clearTimeout(highlighterFadeTimeout);
            };
            var initHighlighterFade = function(duration) {
                highlighterFadeTimeout = setTimeout('triggerHighlighterFade()',duration);
            };
            var mouseoverboxFadeTimeout;
            var triggerMouseoverboxFade = function() {
                $("#mouseoverbox").fadeOut(400,"linear");
            };
            var clearMouseoverboxFade = function() {
                clearTimeout(mouseoverboxFadeTimeout);
            };
            var initMouseoverboxFade = function(duration) {
                mouseoverboxFadeTimeout = setTimeout('triggerMouseoverboxFade()',duration);
            };
            var mouseclickHandler = function(e,data) {
                var nodes = data.nodes;
                var ids = data.ids;
                alert('you clicked node with id '+nodes[0].id);
            };
            var mousemoveHandler = function(e,data) {
                if (data.nodes[0] == undefined) return;
                $("#debug-info").html("<span><p>" + e.pageX + ", " + e.pageY + "; id = " + data.ids[0] + "; label = " + data.nodes[0].label + "</p></span>");
                updateHighlighter(e,data);
                updateMouseoverbox(e,data);
            };
            var mouseleaveHandler = function() {
                //console.log("mouseleaveHandler");
                clearMouseoverboxFade();
                triggerMouseoverboxFade();
                clearHighlighterFade();
                triggerHighlighterFade();
            };
            var updateHighlighter = function(e,data) {
                $(".highlighter").hide().css("background-color","");
                for (var i = 0; i < data.nodes.length-1; i++) {
                    var offset = $("#treemap").offset();
                    var divId = "highlighter"+i;
                    if ( $("#"+divId).length == 0 ) {
                        $("#highlighter").append("<div id=\""+divId+"\" class=\"highlighter\"></div>");
                    }
                    $("#"+divId).css({
                        "display":"inline",
                        "left":data.nodes[i].geometry[0]+offset.left,
                        "top":data.nodes[i].geometry[1]+offset.top,
                        "width":data.nodes[i].geometry[2],
                        "height":data.nodes[i].geometry[3]
                    });
                    /*if (data.nodes[i].hasOwnProperty('children') === false) {
                        var rgb = data.nodes[i].computedColor;
                        $("#"+divId).css("background-color","rgba("+rgb[0]+","+rgb[1]+","+rgb[2]+",0.0)");
                    }*/
                    $("#"+divId).show();
                }
                if (highlighterFadeTimeout != undefined) clearHighlighterFade();
                initHighlighterFade(30000);
                $("#highlighter").show();
            };
            var updateMouseoverbox = function(e,data) {
                $(".mouseoverbox").hide();
                if (data.nodes[0].hasOwnProperty('children') === false) {
                    $("#mouseoverbox").css({"background-color":"rgba(255,255,255,0.8)"});
                } else {
                    $("#mouseoverbox").css({"background-color":"rgba(255,255,200,0.8)"});
                }
                $("#mouseoverbox").html("<span>"
                    + "<p>" + data.nodes[0].label 
                    + "</p><p>x = " + blah[data.nodes[0].id].x + "</p>"
                    + "</p><p>y = " + blah[data.nodes[0].id].y + "</p>"
                    + "</p><p>z = " + blah[data.nodes[0].id].z + "</p>"
                    + "</span>");
                var mouseoverboxWidth = $("#mouseoverbox").width();
                var mouseoverboxHeight = $("#mouseoverbox").height();
                var treemapWidth = $("#treemap").width();
                var treemapHeight = $("#treemap").height();
                var treemapOffset = $("#treemap").offset();
                if (e.pageX + mouseoverboxWidth + 16 > treemapOffset.left + treemapWidth) {
                    $("#mouseoverbox").css({ "left":e.pageX-mouseoverboxWidth-8 });
                } else {
                    $("#mouseoverbox").css({ "left":e.pageX+16 });
                }
                if (e.pageY + mouseoverboxHeight > treemapOffset.top + treemapHeight) {
                    $("#mouseoverbox").css({ "top":e.pageY-mouseoverboxHeight });
                } else {
                    $("#mouseoverbox").css({ "top":e.pageY });
                }
                if (mouseoverboxFadeTimeout != undefined) clearMouseoverboxFade();
                initMouseoverboxFade(30000);
                $("#mouseoverbox").show();
            };
            var init = function(){
                $("#t1").click(function(){
                    $("#debug-info").html("<span><p>0,0</p></span>");
                    $("#treemap").treemap({
                        "dimensions":[900,300],
                        "nodeData":[
                            {"id":"2fc414e2-ae59-41ed-8cba-377be0950b9d", "label":"root", "size":[1.0,1.0], "color":[1.0], "children": 
[
                    {"id":"23f627dc-6078-403e-96d3-c05aabf9f2c9", "label":"blah1", "size":[.25], "color":[.39], "children":[
                        {"id":"ce96d31f-24fa-4258-bd25-c94191096c86", "label":"blah11", "size":[.25], "color":[.74]},
                        {"id":"91e0ea1d-47e9-4520-b991-2fdb7d73caf1", "label":"blah12", "size":[.25], "color":[.98]},
                        {"id":"62188591-f1b2-42df-a6aa-6831a8c53352", "label":"blah13", "size":[.16667], "color":[.39]},
                        {"id":"b80861a4-cdad-49fa-b6f3-aa8508f2bf7d", "label":"blah14", "size":[.125], "color":[.19]},
                        {"id":"9216f340-4949-472b-8246-b25a71dd9916", "label":"blah15", "size":[.083333], "color":[.52]},
                        {"id":"40236148-e7b4-4a0d-ba33-463b814ba736", "label":"blah16", "size":[.083333], "color":[.98]},
                        {"id":"c12264b7-e79e-444d-b357-6b002f0ada65", "label":"blah17", "size":[.041666667], "color":[.74]}
                    ]},
                    {"id":"126debf5-aa68-45bb-9603-8808d6bfdb79", "label":"blah2", "size":[.25], "color":[.52], "children":[
                        {"id":"634c7555-31a8-4d35-adf3-b078b91b6fa1", "label":"blah21", "size":[.25], "color":[.32]},
                        {"id":"2eac5833-59f8-49df-be6d-5debc8af0a83", "label":"blah22", "size":[.25], "color":[.39]},
                        {"id":"50790bdd-f30d-4c52-960f-ec396a20ecc1", "label":"blah23", "size":[.16667], "color":[.32]},
                        {"id":"15b8f1e1-e0ee-4780-9d12-dc483384e678", "label":"blah24", "size":[.125], "color":[.85]},
                        {"id":"4e14522d-04bc-4a1c-8c66-3a847d38782d", "label":"blah25", "size":[.083333], "color":[.52]},
                        {"id":"92cf9150-3b91-47dd-8dce-d9a4c9c7e8ee", "label":"blah26", "size":[.083333], "color":[.63]},
                        {"id":"97794307-46b8-44eb-865d-3d8c2a95ea83", "label":"blah27", "size":[.041666667], "color":[.19]}
                    ]},
                    {"id":"7e3f0349-ce9d-4aea-a203-0e0a0cc45ada", "label":"blah3", "size":[.16667], "color":[.74], "children":[
                        {"id":"1dbf73a8-585b-4075-9f63-c16201204a03", "label":"blah31", "size":[.25], "color":[.39]},
                        {"id":"caefaba5-ab72-4445-8f9d-ce1e62f68606", "label":"blah32", "size":[.25], "color":[.85]},
                        {"id":"89bd30be-b249-41d0-a24b-6fe4a5c20ffe", "label":"blah33", "size":[.16667], "color":[.63], "children":[
                            {"id":"7d56b381-3543-4ada-8a9b-86a8adce97a2", "label":"blah331", "size":[.25], "color":[.39]},
                            {"id":"5f3fcf29-7b66-46cc-955d-9fe3ba08d37a", "label":"blah332", "size":[.25], "color":[.85]},
                            {"id":"50aa205c-57e7-4c6a-b2f9-a50df14593ff", "label":"blah333", "size":[.16667], "color":[.63]},
                            {"id":"beba7a53-cc5c-4fd8-8de0-3263f3e9973c", "label":"blah334", "size":[.125], "color":[.52]},
                            {"id":"b15f0ae4-179d-4557-b755-57c25a69c150", "label":"blah335", "size":[.083333], "color":[.74]},
                            {"id":"cecbda69-3736-457e-8128-674277e618cf", "label":"blah336", "size":[.083333], "color":[.29]},
                            {"id":"496c7052-6826-4860-8ebd-70ee441ac3e3", "label":"blah337", "size":[.041666667], "color":[.98]}
                        ]},
                        {"id":"57582ef2-b933-485f-9b20-8db82db7403e", "label":"blah34", "size":[.125], "color":[.52]},
                        {"id":"ef593822-a89f-4241-98fe-973349ad487d", "label":"blah35", "size":[.083333], "color":[.74]},
                        {"id":"c93cd65d-a96c-4090-b277-9ddc5f645b06", "label":"blah36", "size":[.083333], "color":[.29]},
                        {"id":"81c3e4d8-7ea9-4f7c-a401-01c901b2e9ad", "label":"blah37", "size":[.041666667], "color":[.98]}
                    ]},
                    {"id":"a3bec3a8-55b6-4d05-a2bc-b289ed1ad346", "label":"blah4", "size":[.125], "color":[.52], "children":[
                        {"id":"27605654-f4fb-4ec0-8967-9c6aaa96934b", "label":"blah41", "size":[.25], "color":[.19]},
                        {"id":"a113de2d-80b1-4223-b040-bb21fb332669", "label":"blah42", "size":[.25], "color":[.52]},
                        {"id":"121fec09-0654-4de1-b27e-3ff23e25dac0", "label":"blah43", "size":[.16667], "color":[.09]},
                        {"id":"0b1c34bf-ae59-40df-a89e-3b9a05feec8d", "label":"blah44", "size":[.125], "color":[.32]},
                        {"id":"6e4576d4-cf15-4c4a-93c2-8408d40a1253", "label":"blah45", "size":[.083333], "color":[.39]},
                        {"id":"55d92db9-52c1-4709-a96b-592c8f886247", "label":"blah46", "size":[.083333], "color":[.31]},
                        {"id":"8dca9e0e-6e40-461f-b3fc-e5c3dde35153", "label":"blah47", "size":[.041666667], "color":[.74]}
                    ]},
                    {"id":"c467043d-b862-4bd5-b7c2-056f4d743a5e", "label":"blah5", "size":[.083333], "color":[.39], "children":[
                        {"id":"e0b3ced3-96c4-4f01-97e6-8867526eff71", "label":"blah51", "size":[.25], "color":[.31]},
                        {"id":"904ad26e-fde0-41d8-8b5e-97907a1f51c7", "label":"blah52", "size":[.25], "color":[.85]},
                        {"id":"8f58816c-e1d5-4594-9f9e-85d6a11f0ac8", "label":"blah53", "size":[.16667], "color":[.63]},
                        {"id":"ee1ca0bb-a4af-43e2-adcd-8fa9ed4f05b5", "label":"blah54", "size":[.125], "color":[.52]},
                        {"id":"1f7df236-7854-4aac-8e31-b1aded537c86", "label":"blah55", "size":[.083333], "color":[.98]},
                        {"id":"e411614a-30c9-4a0f-9855-52de98a37a64", "label":"blah56", "size":[.083333], "color":[.32]},
                        {"id":"234fa244-33cd-42dd-b4ad-291ea8bc8fae", "label":"blah57", "size":[.041666667], "color":[.39]}
                    ]},
                    {"id":"ae6f93e2-9c4c-4f6c-87e2-0260aebeba55", "label":"blah6", "size":[.083333], "color":[.98], "children":[
                        {"id":"4511fee8-ae17-4df1-b84b-a3e1a66ea470", "label":"blah61", "size":[.25], "color":[.19]},
                        {"id":"ab206acd-b0f7-4789-9f17-35b54ce119d9", "label":"blah62", "size":[.25], "color":[.74]},
                        {"id":"d436ff53-076d-4b8a-86cc-c102ebf58a3f", "label":"blah63", "size":[.16667], "color":[.29]},
                        {"id":"25a300d6-c361-43ec-b9e1-bad3399383b8", "label":"blah64", "size":[.125], "color":[.52]},
                        {"id":"391c72a8-1db8-4d7c-a84f-51200d092159", "label":"blah65", "size":[.083333], "color":[.74]},
                        {"id":"7071d634-c233-45a2-a169-f0fbe2403292", "label":"blah66", "size":[.083333], "color":[.39]},
                        {"id":"939985e5-1872-4ec4-90d7-1b3c5ab62a2f", "label":"blah67", "size":[.041666667], "color":[.63]}
                    ]},
                    {"id":"08095bd4-0942-470c-92fc-eb042d9f14f3", "label":"blah7", "size":[.041666667], "color":[.85], "children":[
                        {"id":"0e27d9c9-4b20-44ec-b22b-d19947d1d8c4", "label":"blah71", "size":[.25], "color":[.39]},
                        {"id":"2fa79804-ac2c-47c6-a370-80790742f3d7", "label":"blah72", "size":[.25], "color":[.52]},
                        {"id":"e3ede063-f42b-4573-af6b-c0a3f9281483", "label":"blah73", "size":[.16667], "color":[.74]},
                        {"id":"40e92699-fae5-4703-9520-fe5f5fa56ef6", "label":"blah74", "size":[.125], "color":[.85]},
                        {"id":"9296b705-2bd0-4c77-a5f2-2cbe775fa84a", "label":"blah75", "size":[.083333], "color":[.98]},
                        {"id":"432db33d-f5a3-4acd-a5ef-739b0de091c0", "label":"blah76", "size":[.083333], "color":[.74]},
                        {"id":"4a01b07c-fa6b-4ce6-a12a-2c28c5310475", "label":"blah77", "size":[.041666667], "color":[.52]}
                    ]},
                ]
                        }]
                    })
                    .bind('treemapmousemove',mousemoveHandler)
                    .bind('treemapclick',mouseclickHandler)
                    .mouseleave(function(){mouseleaveHandler()});
                });
                $("#t2").click(function(){
                    $(".highlighter").hide();
                    $("#treemap").unbind()
                    .treemap("option","dimensions",[800,200])
                    .bind('treemapmousemove',mousemoveHandler)
                    .bind('treemapclick',mouseclickHandler)
                    .mouseleave(function(){mouseleaveHandler()});
                });
                $("#t3").click(function(){
                    $(".highlighter").hide().unbind();
                    $("#treemap").unbind()
                    .treemap("option","dimensions",[600,400])
                    .bind('treemapmousemove',mousemoveHandler)
                    .bind('treemapclick',mouseclickHandler)
                    .mouseleave(function(){mouseleaveHandler()});
                });
                $("#t5").click(function(){
                    $("#treemap").treemap("option","colorGradient",{
                        resolution:1024,
                        colorStops:[
                            {"val":0,  "color":"#a00"},
                            {"val":.4,"color":"#f00"},
                            {"val":.5, "color":"#fff"},
                            {"val":.6,"color":"#0f0"},
                            {"val":1,  "color":"#070"}
                        ]
                    });
                });
                $("#t4").click(function(){
                    $("#treemap").treemap("option","colorGradient",{
                        resolution:1024,
                        colorStops:[
                            {"val":0,"color":"#770"},
                            {"val":0.5,"color":"#fff"},
                            {"val":1,"color":"#077"}
                        ]
                    });
                });
                $("#t6").click(function(){
                    $("#treemap").treemap("option","nodeGradient",function(ctx,rect,rgb){
                        var r1 = Math.min(rect[2],rect[3])*0.1;
                        var r2 = Math.max(rect[2],rect[3]);
                        var x = rect[0]+rect[2]*0.5;
                        var y = rect[1]+rect[3]*0.5;
                        var gradient = ctx.createRadialGradient(x,y,r1,x,y,r2);
                        gradient.addColorStop(0,TreemapUtils.lighterColor(TreemapUtils.rgb2hex(rgb),0.2));
                        gradient.addColorStop(1,TreemapUtils.darkerColor(TreemapUtils.rgb2hex(rgb),0.2));
                        return gradient;
                    })
                });
                $("#t7").click(function(){
                    $("#treemap").treemap("option","nodeGradient",function(ctx,rect,rgb){
                        var min = Math.min(rect[2],rect[3]);
                        var gradient = ctx.createLinearGradient(rect[0]+rect[2]-min,rect[1]+rect[3]-min,rect[0]+rect[2],rect[1]+rect[3]);
                        gradient.addColorStop(0,TreemapUtils.rgb2hex(rgb));
                        gradient.addColorStop(0.7,TreemapUtils.rgb2hex(rgb));
                        gradient.addColorStop(1,TreemapUtils.darkerColor(TreemapUtils.rgb2hex(rgb),0.2));
                        return gradient;
                    })
                });
                $("#t8").click(function(){
                    $(".highlighter").hide().unbind();
                    $("#treemap").unbind().treemap("destroy");
                    $("#debug-info").html("<span><p>click the on button to create treemap</p></span>");
                });
            };
            $(document).ready(function(){
                        init();
            });
        </script>
    </body>
</html>

