<!DOCTYPE HTML>
<html>
    <head>
        <meta charset="utf-8"/>
        <link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/ui-lightness/jquery-ui.css" media=screen>
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.18/jquery-ui.min.js"></script>
        <script type="text/javascript" src="js/jquery.ui.treemap.js"></script>
        <script type="text/javascript" src="blah.js"></script>
        <style type="text/css">
            #content { margin-right: auto; margin-left: auto; width: 900px; }
            canvas { border: 1px solid #f00; }
            #treemap { display: inline-block; }
            .highlighter { border: 1px solid #ff0; position: absolute; display: none; pointer-events: none; }
            .mouseoverbox { 
                border: 1px solid #aaa; 
                position: absolute; 
                background-color: #fff; 
                pointer-events: none; 
                display: none;
            }
            .mouseoverbox p {
                margin: 0px;
                padding: 0px;
                font-size: 0.625em;
                color: #444;
            }
        </style>
    </head>
    <body>
        <div id="content"> 
            <div id="header"></div>
            <div id="bodyContent">
                <div id="example1">
                    <h3>Javascript treemap</h3>
                    <h4>Description</h4>
                    <p>Utilizing the jQuery widget factory and HTML5 canvas this Javascript treemap widget presents hierarchical data using the squarified treemap layout described in <a href="http://www.win.tue.nl/~vanwijk/stm.pdf">"Squarified Treemaps"</a> by Mark Bruls, Kees Huizing and Jarke J. van Wijk.  Alternate layout algorithms could easily be added to the widget and made selectable.</p>
                    <p>Development and testing has primarily been limited to current versions of Chrome and FF.  I rarely test (and fix for) IE.</p>
                    <p>The following example demonstrates the creation, destruction and dynamic update of some of the treemap plugin options.  Using the buttons below, create the treemap, then click the other buttons to update the treemap plugin's dimensions, color gradient and the gradient used to render the treemap leaf nodes.</p>
                    <input id="t1" type="button" value="create"/>
                    <input id="t2" type="button" value="800x200"/>
                    <input id="t3" type="button" value="600x400"/>
                    <input id="t4" type="button" value="color1"/>
                    <input id="t5" type="button" value="color2"/>
                    <input id="t6" type="button" value="gradient1"/>
                    <input id="t7" type="button" value="gradient2"/>
                    <input id="t8" type="button" value="destroy"/>
                    <div><span id="treemap"></span></div>
                    <div id="debug-info"><span><p>Click the 'create' button to create example treemap</p></span></div>
                    <div id="highlighter"></div>
                    <div id="mouseoverbox" class="mouseoverbox"></div>
                    
                    <h4>Events</h4>
                    <p><b>treemapmousemove</b> event can be used to trigger and update the presentation of a mouseover box and node highlighter(s) via a Javascript callback.  The rendering of the mouseover box and node highlighter(s) are not part of the treemap plugin.  The mouseover box and highlighter(s) are optional presentation elements and can be populated, styled and made dynamic using HTML, CSS and Javascript.  This sample code demonstrates what information is available to the event handlers and how one might choose to highlight and/or display node details of the treemap.</p>
                    <p><b>treemapmouseclick</b> event can be used to trigger dynamic updates to the page's presentation via a Javascript callback.  This sample code demonstrates what information is available to the event handler.</p>
                </div>
                <div><p>The jQuery treemap widget code and this HTML, CSS, Javascript demo is available from <a href="https://github.com/evancarey/jsTreemap">https://github.com/evancarey/jsTreemap</a></p></div>
            </div>
            <div id="footer">
            </div>
        </div>
	    <script type="text/javascript">
            var highlighterFadeTimeout;
            var triggerHighlighterFade = function() {
                $("#highlighter").fadeOut(400,"linear");
            };
            var clearHighlighterFade = function() {
                clearTimeout(highlighterFadeTimeout);
            };
            var initHighlighterFade = function(duration) {
                highlighterFadeTimeout = setTimeout('triggerHighlighterFade()',duration);
            };
            var mouseoverboxFadeTimeout;
            var triggerMouseoverboxFade = function() {
                $("#mouseoverbox").fadeOut(400,"linear");
            };
            var clearMouseoverboxFade = function() {
                clearTimeout(mouseoverboxFadeTimeout);
            };
            var initMouseoverboxFade = function(duration) {
                mouseoverboxFadeTimeout = setTimeout('triggerMouseoverboxFade()',duration);
            };
            var mouseclickHandler = function(e,data) {
                var nodes = data.nodes;
                var ids = data.ids;
                alert('you clicked node with id '+nodes[0].id);
            };
            var mousemoveHandler = function(e,data) {
                if (data.nodes[0] == undefined) return;
                $("#debug-info").html("<span><p>" + e.pageX + ", " + e.pageY + "; id = " + data.ids[0] + "; label = " + data.nodes[0].label + "</p></span>");
                updateHighlighter(e,data);
                updateMouseoverbox(e,data);
            };
            var mouseleaveHandler = function() {
                //console.log("mouseleaveHandler");
                clearMouseoverboxFade();
                triggerMouseoverboxFade();
                clearHighlighterFade();
                triggerHighlighterFade();
            };
            var updateHighlighter = function(e,data) {
                $(".highlighter").hide().css("background-color","");
                for (var i = 0; i < data.nodes.length; i++) {
                    var offset = $("#treemap").offset();
                    var divId = "highlighter"+i;
                    if ( $("#"+divId).length == 0 ) {
                        $("#highlighter").append("<div id=\""+divId+"\" class=\"highlighter\"></div>");
                    }
                    $("#"+divId).css({
                        "display":"inline",
                        "left":data.nodes[i].geometry[0]+offset.left,
                        "top":data.nodes[i].geometry[1]+offset.top,
                        "width":data.nodes[i].geometry[2],
                        "height":data.nodes[i].geometry[3]
                    });
                    /*if (data.nodes[i].hasOwnProperty('children') === false) {
                        var rgb = data.nodes[i].computedColor;
                        $("#"+divId).css("background-color","rgba("+rgb[0]+","+rgb[1]+","+rgb[2]+",0.0)");
                    }*/
                    $("#"+divId).show();
                }
                if (highlighterFadeTimeout != undefined) clearHighlighterFade();
                initHighlighterFade(30000);
                $("#highlighter").show();
            };
            var updateMouseoverbox = function(e,data) {
                $(".mouseoverbox").hide();
                if (data.nodes[0].hasOwnProperty('children') === false) {
                    $("#mouseoverbox").css({"background-color":"rgba(255,255,255,0.8)"});
                } else {
                    $("#mouseoverbox").css({"background-color":"rgba(255,255,200,0.8)"});
                }
                $("#mouseoverbox").html("<span>"
                    + "<p>" + data.nodes[0].label 
                    + "</p><p>x = " + blah[data.nodes[0].id].x + "</p>"
                    + "</p><p>y = " + blah[data.nodes[0].id].y + "</p>"
                    + "</p><p>z = " + blah[data.nodes[0].id].z + "</p>"
                    + "</span>");
                var mouseoverboxWidth = $("#mouseoverbox").width();
                var mouseoverboxHeight = $("#mouseoverbox").height();
                var treemapWidth = $("#treemap").width();
                var treemapHeight = $("#treemap").height();
                var treemapOffset = $("#treemap").offset();
                if (e.pageX + mouseoverboxWidth + 16 > treemapOffset.left + treemapWidth) {
                    $("#mouseoverbox").css({ "left":e.pageX-mouseoverboxWidth-8 });
                } else {
                    $("#mouseoverbox").css({ "left":e.pageX+16 });
                }
                if (e.pageY + mouseoverboxHeight > treemapOffset.top + treemapHeight) {
                    $("#mouseoverbox").css({ "top":e.pageY-mouseoverboxHeight });
                } else {
                    $("#mouseoverbox").css({ "top":e.pageY });
                }
                if (mouseoverboxFadeTimeout != undefined) clearMouseoverboxFade();
                initMouseoverboxFade(30000);
                $("#mouseoverbox").show();
            };
            var init = function(){
                $("#treemap-ex1").treemap({
                    "dimensions":[900,300],
                    "nodeData":[
                        {"id":"23f627dc-6078-403e-96d3-c05aabf9f2c9", "label":"blah1", "size":[1.0], "color":[.39], "children":[
                            {"id":"ce96d31f-24fa-4258-bd25-c94191096c86", "label":"blah11", "size":[.25], "color":[.74]},
                            {"id":"91e0ea1d-47e9-4520-b991-2fdb7d73caf1", "label":"blah12", "size":[.25], "color":[.98]},
                            {"id":"62188591-f1b2-42df-a6aa-6831a8c53352", "label":"blah13", "size":[.16667], "color":[.39]},
                            {"id":"b80861a4-cdad-49fa-b6f3-aa8508f2bf7d", "label":"blah14", "size":[.125], "color":[.19]},
                            {"id":"9216f340-4949-472b-8246-b25a71dd9916", "label":"blah15", "size":[.083333], "color":[.52]},
                            {"id":"40236148-e7b4-4a0d-ba33-463b814ba736", "label":"blah16", "size":[.083333], "color":[.98]},
                            {"id":"c12264b7-e79e-444d-b357-6b002f0ada65", "label":"blah17", "size":[.041666667], "color":[.74]}
                        ]}
                    ],
                });
                $("#t1").click(function(){
                    $("#debug-info").html("<span><p>0,0</p></span>");
                    $("#treemap").treemap({
                        "dimensions":[900,300],
                        "nodeData":[
                            {"id":"2fc414e2", "label":"root", "size":[1.0,1.0], "color":[1.0], "children": 
[
                    {"id":"23f627dc", "label":"blah1", "size":[.25], "color":[.39], "children":[
                        {"id":"ce96d31f", "label":"blah11", "size":[.25], "color":[.74]},
                        {"id":"91e0ea1d", "label":"blah12", "size":[.25], "color":[.98]},
                        {"id":"62188591", "label":"blah13", "size":[.16667], "color":[.39]},
                        {"id":"b80861a4", "label":"blah14", "size":[.125], "color":[.19]},
                        {"id":"9216f340", "label":"blah15", "size":[.083333], "color":[.52]},
                        {"id":"40236148", "label":"blah16", "size":[.083333], "color":[.98]},
                        {"id":"c12264b7", "label":"blah17", "size":[.041666667], "color":[.74]}
                    ]},
                    {"id":"126debf5", "label":"blah2", "size":[.25], "color":[.52], "children":[
                        {"id":"634c7555", "label":"blah21", "size":[.25], "color":[.32]},
                        {"id":"2eac5833", "label":"blah22", "size":[.25], "color":[.39]},
                        {"id":"50790bdd", "label":"blah23", "size":[.16667], "color":[.32]},
                        {"id":"15b8f1e1", "label":"blah24", "size":[.125], "color":[.85]},
                        {"id":"4e14522d", "label":"blah25", "size":[.083333], "color":[.52]},
                        {"id":"92cf9150", "label":"blah26", "size":[.083333], "color":[.63]},
                        {"id":"97794307", "label":"blah27", "size":[.041666667], "color":[.19]}
                    ]},
                    {"id":"7e3f0349", "label":"blah3", "size":[.16667], "color":[.74], "children":[
                        {"id":"1dbf73a8", "label":"blah31", "size":[.25], "color":[.39]},
                        {"id":"caefaba5", "label":"blah32", "size":[.25], "color":[.85]},
                        {"id":"89bd30be", "label":"blah33", "size":[.16667], "color":[.63], "children":[
                            {"id":"7d56b381", "label":"blah331", "size":[.25], "color":[.39]},
                            {"id":"5f3fcf29", "label":"blah332", "size":[.25], "color":[.85]},
                            {"id":"50aa205c", "label":"blah333", "size":[.16667], "color":[.63]},
                            {"id":"beba7a53", "label":"blah334", "size":[.125], "color":[.52]},
                            {"id":"b15f0ae4", "label":"blah335", "size":[.083333], "color":[.74]},
                            {"id":"cecbda69", "label":"blah336", "size":[.083333], "color":[.29]},
                            {"id":"496c7052", "label":"blah337", "size":[.041666667], "color":[.98]}
                        ]},
                        {"id":"57582ef2", "label":"blah34", "size":[.125], "color":[.52]},
                        {"id":"ef593822", "label":"blah35", "size":[.083333], "color":[.74]},
                        {"id":"c93cd65d", "label":"blah36", "size":[.083333], "color":[.29]},
                        {"id":"81c3e4d8", "label":"blah37", "size":[.041666667], "color":[.98]}
                    ]},
                    {"id":"a3bec3a8", "label":"blah4", "size":[.125], "color":[.52], "children":[
                        {"id":"27605654", "label":"blah41", "size":[.25], "color":[.19]},
                        {"id":"a113de2d", "label":"blah42", "size":[.25], "color":[.52]},
                        {"id":"121fec09", "label":"blah43", "size":[.16667], "color":[.09]},
                        {"id":"0b1c34bf", "label":"blah44", "size":[.125], "color":[.32]},
                        {"id":"6e4576d4", "label":"blah45", "size":[.083333], "color":[.39]},
                        {"id":"55d92db9", "label":"blah46", "size":[.083333], "color":[.31]},
                        {"id":"8dca9e0e", "label":"blah47", "size":[.041666667], "color":[.74]}
                    ]},
                    {"id":"c467043d", "label":"blah5", "size":[.083333], "color":[.39], "children":[
                        {"id":"e0b3ced3", "label":"blah51", "size":[.25], "color":[.31]},
                        {"id":"904ad26e", "label":"blah52", "size":[.25], "color":[.85]},
                        {"id":"8f58816c", "label":"blah53", "size":[.16667], "color":[.63]},
                        {"id":"ee1ca0bb", "label":"blah54", "size":[.125], "color":[.52]},
                        {"id":"1f7df236", "label":"blah55", "size":[.083333], "color":[.98]},
                        {"id":"e411614a", "label":"blah56", "size":[.083333], "color":[.32]},
                        {"id":"234fa244", "label":"blah57", "size":[.041666667], "color":[.39]}
                    ]},
                    {"id":"ae6f93e2", "label":"blah6", "size":[.083333], "color":[.98], "children":[
                        {"id":"4511fee8", "label":"blah61", "size":[.25], "color":[.19]},
                        {"id":"ab206acd", "label":"blah62", "size":[.25], "color":[.74]},
                        {"id":"d436ff53", "label":"blah63", "size":[.16667], "color":[.29]},
                        {"id":"25a300d6", "label":"blah64", "size":[.125], "color":[.52]},
                        {"id":"391c72a8", "label":"blah65", "size":[.083333], "color":[.74]},
                        {"id":"7071d634", "label":"blah66", "size":[.083333], "color":[.39]},
                        {"id":"939985e5", "label":"blah67", "size":[.041666667], "color":[.63]}
                    ]},
                    {"id":"08095bd4", "label":"blah7", "size":[.041666667], "color":[.85], "children":[
                        {"id":"0e27d9c9", "label":"blah71", "size":[.25], "color":[.39]},
                        {"id":"2fa79804", "label":"blah72", "size":[.25], "color":[.52]},
                        {"id":"e3ede063", "label":"blah73", "size":[.16667], "color":[.74]},
                        {"id":"40e92699", "label":"blah74", "size":[.125], "color":[.85]},
                        {"id":"9296b705", "label":"blah75", "size":[.083333], "color":[.98]},
                        {"id":"432db33d", "label":"blah76", "size":[.083333], "color":[.74]},
                        {"id":"4a01b07c", "label":"blah77", "size":[.041666667], "color":[.52]}
                    ]},
                ]
                        }]
                    })
                    .bind('treemapmousemove',mousemoveHandler)
                    .bind('treemapclick',mouseclickHandler)
                    .mouseleave(function(){mouseleaveHandler()});
                });
                $("#t2").click(function(){
                    $(".highlighter").hide();
                    $("#treemap").unbind()
                    .treemap("option","dimensions",[800,200])
                    .bind('treemapmousemove',mousemoveHandler)
                    .bind('treemapclick',mouseclickHandler)
                    .mouseleave(function(){mouseleaveHandler()});
                });
                $("#t3").click(function(){
                    $(".highlighter").hide().unbind();
                    $("#treemap").unbind()
                    .treemap("option","dimensions",[600,400])
                    .bind('treemapmousemove',mousemoveHandler)
                    .bind('treemapclick',mouseclickHandler)
                    .mouseleave(function(){mouseleaveHandler()});
                });
                $("#t5").click(function(){
                    $("#treemap").treemap("option","colorGradients",[{
                        resolution:1024,
                        colorStops:[
                            {"val":0,  "color":"#a00"},
                            {"val":.4,"color":"#f00"},
                            {"val":.5, "color":"#fff"},
                            {"val":.6,"color":"#0f0"},
                            {"val":1,  "color":"#070"}
                        ]
                    }]);
                });
                $("#t4").click(function(){
                    $("#treemap").treemap("option","colorGradients",[{
                        resolution:1024,
                        colorStops:[
                            {"val":0,"color":"#520"},
                            {"val":.25,"color":"#ff0"},
                            {"val":0.5,"color":"#fff"},
                            {"val":0.75,"color":"#0ff"},
                            {"val":1,"color":"#052"}
                        ]
                    }]);
                });
                $("#t6").click(function(){
                    $("#treemap").treemap("option","nodeGradient",function(ctx,rect,rgb){
                        var min = Math.min(rect[2],rect[3]);
                        var gradient = ctx.createLinearGradient(rect[0]+rect[2]-min,rect[1]+rect[3]-min,rect[0]+rect[2],rect[1]+rect[3]);
                        gradient.addColorStop(0,TreemapUtils.rgb2hex(rgb));
                        gradient.addColorStop(0.7,TreemapUtils.rgb2hex(rgb));
                        gradient.addColorStop(1,TreemapUtils.darkerColor(TreemapUtils.rgb2hex(rgb),0.2));
                        return gradient;
                    })
                });
                $("#t7").click(function(){
                    $("#treemap").treemap("option","nodeGradient",function(ctx,rect,rgb){
                        var r1 = Math.min(rect[2],rect[3])*0.1;
                        var r2 = Math.max(rect[2],rect[3]);
                        var x = rect[0]+rect[2]*0.5;
                        var y = rect[1]+rect[3]*0.5;
                        var gradient = ctx.createRadialGradient(x,y,r1,x,y,r2);
                        gradient.addColorStop(0,TreemapUtils.lighterColor(TreemapUtils.rgb2hex(rgb),0.2));
                        gradient.addColorStop(1,TreemapUtils.darkerColor(TreemapUtils.rgb2hex(rgb),0.2));
                        return gradient;
                    })
                });
                $("#t8").click(function(){
                    $(".highlighter").hide().unbind();
                    $("#treemap").unbind().treemap("destroy");
                    $("#debug-info").html("<span><p>click the 'create' button to create treemap</p></span>");
                });
            };
            $(document).ready(function(){
                        init();
            });
        </script>
    </body>
</html>

